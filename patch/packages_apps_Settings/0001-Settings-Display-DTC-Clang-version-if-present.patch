From cc2b73fed66a111ffc0d5137c2101d8f1c85e1df Mon Sep 17 00:00:00 2001
From: sub77 <sub77@ymail.com>
Date: Fri, 17 Jun 2016 07:11:05 -0500
Subject: [PATCH] Settings-Display-DTC-Clang-version-if-present

Change-Id: Id4a4e92c262f4adfe3598ea06c6a49c49d3c8f8c
---
 res/values/du_strings.xml                        | 4 ++++
 res/xml/device_info_settings.xml                 | 7 +++++++
 src/com/android/settings/DeviceInfoSettings.java | 7 +++++++
 3 files changed, 18 insertions(+)

diff --git a/res/values/du_strings.xml b/res/values/du_strings.xml
index 885f5a3..81c4bd7 100644
--- a/res/values/du_strings.xml
+++ b/res/values/du_strings.xml
@@ -383,4 +383,8 @@
     <!-- Volume settings - Volume adjustment sound -->
     <string name="volume_adjust_sounds_title">Volume adjustment sounds</string>
 
+    <!-- Clang version -->
+    <string name="dtc_version">Clang</string>
+    <string name="dtc_version_default">None</string>
+
 </resources>
diff --git a/res/xml/device_info_settings.xml b/res/xml/device_info_settings.xml
index 3840b81..94eba9e 100644
--- a/res/xml/device_info_settings.xml
+++ b/res/xml/device_info_settings.xml
@@ -112,6 +112,13 @@
                 android:title="@string/security_patch"
                 android:summary="@string/device_info_default"/>
 
+       <!-- GCC build info -->
+       <Preference android:key="dtc_version"
+                style="?android:preferenceInformationStyle"
+                android:title="@string/dtc_version"
+                android:summary="@string/dtc_version_default"
+                android:selectable="false" />
+
         <!-- DU version -->
         <Preference android:key="mod_version"
                 style="?android:preferenceInformationStyle"
diff --git a/src/com/android/settings/DeviceInfoSettings.java b/src/com/android/settings/DeviceInfoSettings.java
index 45c17a4..d23a0de 100644
--- a/src/com/android/settings/DeviceInfoSettings.java
+++ b/src/com/android/settings/DeviceInfoSettings.java
@@ -89,6 +89,8 @@ public class DeviceInfoSettings extends SettingsPreferenceFragment implements In
     private static final String KEY_DUUPDATER_PACKAGE_NAME = "com.dirtyunicorns.duupdater";
     private static final String KEY_ABOUTDU = "aboutdu";
     private static final String KEY_ABOUTDU_PACKAGE_NAME = "com.dirtyunicorns.about";
+    private static final String KEY_DTC_VERSION = "dtc_version";
+    private static final String PROPERTY_DTC_VERSION = "ro.dtc.version";
 
     private PreferenceScreen mDuUpdater;
     private PreferenceScreen mDuAbout;
@@ -137,6 +139,7 @@ public class DeviceInfoSettings extends SettingsPreferenceFragment implements In
         setStringSummary(KEY_KERNEL_VERSION, getFormattedKernelVersion());
         findPreference(KEY_KERNEL_VERSION).setEnabled(true);
         setValueSummary(KEY_MOD_VERSION, "ro.mod.version");
+        setValueSummary(KEY_DTC_VERSION, "ro.dtc.version");
 
         if (!SELinux.isSELinuxEnabled()) {
             String status = getResources().getString(R.string.selinux_status_disabled);
@@ -166,6 +169,10 @@ public class DeviceInfoSettings extends SettingsPreferenceFragment implements In
         removePreferenceIfPropertyMissing(getPreferenceScreen(), KEY_SAFETY_LEGAL,
                 PROPERTY_URL_SAFETYLEGAL);
 
+        // Remove DragonTC information if property is not present
+        removePreferenceIfPropertyMissing(getPreferenceScreen(), KEY_DTC_VERSION,
+                PROPERTY_DTC_VERSION);
+
         // Remove Equipment id preference if FCC ID is not set by RIL
         removePreferenceIfPropertyMissing(getPreferenceScreen(), KEY_EQUIPMENT_ID,
                 PROPERTY_EQUIPMENT_ID);
-- 
1.9.1

